---
title: 062: Implementing file uploads and downloads in Nest.js
description: 
published: true
date: 2023-02-04T00:18:04.274Z
tags: 
editor: markdown
dateCreated: 2023-02-04T00:17:59.010Z
---

- [062: Implementación de cargas y descargas de archivos en Nest.js***Spanish** document is available*](/es/Knowledge-base/Nest-js/Learning/062-implementing-file-uploads-and-downloads-in-nest-js)
{.links-list}
- [062：在Nest.js中实现文件上传下载***Chinese Simplified** document is available*](/zh/Knowledge-base/Nest-js/Learning/062-implementing-file-uploads-and-downloads-in-nest-js)
{.links-list}
- [062: Nest.js에서 파일 업로드 및 다운로드 구현***Korean** document is available*](/ko/Knowledge-base/Nest-js/Learning/062-implementing-file-uploads-and-downloads-in-nest-js)
{.links-list}


# 062: Implementing file uploads and downloads in Nest.js

## Introduction

In many web applications, there is a need to allow users to upload and download files. For example, a user may want to upload an image to be used as their profile picture, or download a PDF document that was generated by the application.

In this post, we'll take a look at how to implement file uploads and downloads in a Nest.js application. We'll start by looking at how to upload files, then we'll see how to download them.

## Uploading files

There are two main ways to upload files in Nest.js: using the `multer` module or the ` Nest.js uploadFile` method.

### Using the `multer` module

The `multer` module is a popular option for handling file uploads in Node.js applications. It's easy to use and has a wide range of features.

To use `multer`, you first need to install it from npm:

```
npm install multer
```

Once `multer` is installed, you can use it in your Nest.js application like this:

```javascript
// src/app.controller.ts

import { Controller, Post, UseInterceptors, UploadedFile } from '@nestjs/common';
import { FileInterceptor } from '@nestjs/platform-express';

@Controller()
export class AppController {

  @Post('/upload')
  @UseInterceptors(FileInterceptor('file'))
  uploadFile(@UploadedFile() file) {
    console.log(file);
  }
}
```

In the code above, we've defined a controller with a `/upload` endpoint that accepts file uploads. We've also added the `@UseInterceptors` decorator to use the `FileInterceptor` Nest.js interceptor, which is used to process file uploads.

The `FileInterceptor` interceptor accepts a `name` parameter, which is the name of the form field that contains the file. In our example, the name of the form field is `file`.

Finally, we've added the `@UploadedFile` decorator to the `file` parameter of the `uploadFile` method. This decorator is used to get information about the uploaded file.

If we run the application and upload a file, we should see the following output:

```
{ fieldname: 'file',
  originalname: 'test.txt',
  encoding: '7bit',
  mimetype: 'text/plain',
  buffer: <Buffer 74 65 73 74 0d 0a>,
  size: 9 }
```

As you can see, the `@UploadedFile` decorator gives us information about the uploaded file, such as the original name and mimetype.

### Using the `Nest.js uploadFile` method

Another option for uploading files in Nest.js is to use the `Nest.js uploadFile` method. This method is part of the `@nestjs/common` package, which means you don't need to install any additional dependencies.

To use the `Nest.js uploadFile` method, you first need to create an ` uploadFile` method in your controller:

```javascript
// src/app.controller.ts

import { Controller, Post, Body, HttpCode, HttpStatus } from '@nestjs/common';

@Controller()
export class AppController {

  @Post('/upload')
  @HttpCode(HttpStatus.OK)
  uploadFile(@Body() body) {
    console.log(body);
  }
}
```

In the code above, we've defined a controller with a `/upload` endpoint that accepts file uploads. We've also added the `@HttpCode` decorator to set the HTTP status code to `200`, and the `@Body` decorator to get the request body.

Next, we need to create an ` uploadFile` method in our service:

```javascript
// src/app.service.ts

import { Injectable } from '@nestjs/common';
import { HttpService, HttpStatus, } from '@nestjs/common';
import { ConfigService } from '@nestjs/config';

@Injectable()
export class AppService {
  constructor(
    private readonly httpService: HttpService,
    private readonly configService: ConfigService,
  ) {}

  async uploadFile(file: any) {
    const formData = new FormData();
    formData.append('file', file);

    try {
      const response = await this.httpService.post(
        `${this.configService.get('API_URL')}/upload`,
        formData,
      ).toPromise();

      return response.data;
    } catch (error) {
      throw new HttpException('Internal server error', HttpStatus.INTERNAL_SERVER_ERROR);
    }
  }
}
```

In the code above, we've injected the `HttpService` and `ConfigService` into our `AppService`. We've also created an `uploadFile` method that accepts a `file` parameter.

This method creates a `FormData` object, which is used to submit the file to the `/upload` endpoint. We've also added a try/catch block to catch any errors that occur.

Finally, we need to call the `uploadFile` method from our controller:

```javascript
// src/app.controller.ts

import { Controller, Post, Body, HttpCode, HttpStatus } from '@nestjs/common';

@Controller()
export class AppController {

  constructor(private readonly appService: AppService) {}

  @Post('/upload')
  @HttpCode(HttpStatus.OK)
  uploadFile(@Body() body) {
    this.appService.uploadFile(body);
  }
}
```

In the code above, we've injected the `AppService` into our controller. We've also created a `uploadFile` method that calls the `uploadFile` method from our service.

If we run the application and upload a file, we should see the following output:

```
{ file:
   { fieldname: 'file',
     originalname: 'test.txt',
     encoding: '7bit',
     mimetype: 'text/plain',
     buffer: <Buffer 74 65 73 74 0d 0a>,
     size: 9 } }
```

As you can see, the `Nest.js uploadFile` method gives us information about the uploaded file, such as the original name and mimetype.

## Downloading files

There are two main ways to download files in Nest.js: using the ` Nest.js downloadFile` method or the `Nest.js sendFile` method.

### Using the `Nest.js downloadFile` method

The `Nest.js downloadFile` method is part of the `@nestjs/common` package, which means you don't need to install any additional dependencies.

To use the `Nest.js downloadFile` method, you first need to create a `downloadFile` method in your controller:

```javascript
// src/app.controller.ts

import { Controller, Get, HttpCode, HttpStatus } from '@nestjs/common';

@Controller()
export class AppController {

  @Get('/download')
  @HttpCode(HttpStatus.OK)
  downloadFile() {
    const file = `${__dirname}/../../test.txt`;
    return this.appService.downloadFile(file);
  }
}
```

In the code above, we've defined a controller with a `/download` endpoint that returns a file. We've also added the `@HttpCode` decorator to set the HTTP status code to `200`.

Next, we need to create a `downloadFile` method in our service:

```javascript
// src/app.service.ts

import { Injectable } from '@nestjs/common';
import { HttpService, HttpStatus, } from '@nestjs/common';
import { ConfigService } from '@nestjs/config';

@Injectable()
export class AppService {
  constructor(
    private readonly httpService: HttpService,
    private readonly configService: ConfigService,
  ) {}

  async downloadFile(file: string) {
    try {
      const response = await this.httpService.get(
        `${this.configService.get('API_URL')}/download?file=${file}`,
        {
          responseType: 'arraybuffer',
          headers: {
            'Content-Type': 'application/octet-stream',
            'Content-Disposition': `attachment; filename=${file}`,
          },
        },
      ).toPromise();

      return response.data;
    } catch (error) {
      throw new HttpException('Internal server error', HttpStatus.INTERNAL_SERVER_ERROR);
    }
  }
}
```

In the code above, we've injected the `HttpService` and `ConfigService` into our `AppService`. We've also created a `downloadFile` method that accepts a `file` parameter.

This method makes a GET request to the `/download` endpoint with the `file` query parameter. We've also added a try/catch block to catch any errors that occur.

Finally, we need to call the `downloadFile` method from our controller:

```javascript
// src/app.controller.ts

import { Controller, Get, HttpCode, HttpStatus } from '@nestjs/common';

@Controller()
export class AppController {

  constructor(private readonly appService: AppService) {}

  @Get('/download')
  @HttpCode(HttpStatus.OK)
  downloadFile() {
    const file = `${__dirname}/../../test.txt`;
    return this.appService.downloadFile(file);
  }
}
```

In the code above, we've injected the `AppService` into our controller. We've also created a `downloadFile` method that calls the `downloadFile` method from our service.

If we run the application and visit the `/download` endpoint, we should see the contents of the `test.txt` file.

### Using the `Nest.js sendFile` method

Another option for downloading files in Nest.js is to use the `Nest.js sendFile` method. This method is part of the `@nestjs/common` package, which means you don't need to install any additional dependencies.

To use the `Nest.js sendFile` method, you first need to create a `sendFile` method in your controller:

```javascript
// src/app.controller.ts

import { Controller, Get, Res, HttpCode, HttpStatus } from '@nestjs/common';

@Controller()
export class AppController {

  @Get('/download')
  @HttpCode(HttpStatus.OK)
  downloadFile(@Res() res) {
    const file = `${__dirname}/../../test.txt`;
    return res.sendFile(file);
  }
}
```

In the code above, we've defined a controller with a `/download` endpoint that returns a file. We've also added the `@HttpCode` decorator to set the HTTP status code to `200`, and the `@Res` decorator to get the response object.

Next, we need to create a `sendFile` method in our service:

```javascript
// src/app.service.ts

import { Injectable } from '@nestjs/common';
import { HttpService, HttpStatus, } from '@nestjs/common';
import { ConfigService } from '@nestjs/config';

@Injectable()
export class AppService {
  constructor(
    private readonly httpService: HttpService,
    private readonly configService: ConfigService,
  ) {}

  async sendFile(file: string) {
    try {
      const response = await this.httpService.get(
        `${this.configService.get('API_URL')}/download?file=${file}`,
        {
          responseType: 'arraybuffer',
          headers: {
            'Content-Type': 'application/octet-stream',
            'Content-Disposition': `attachment; filename=${file}`,
          },
        },
      ).toPromise();

      return response.data;
    } catch (error) {
      throw new HttpException('Internal server error', HttpStatus.INTERNAL_SERVER_ERROR);
    }
  }
}
```

In the code above, we've injected the `HttpService` and `ConfigService` into our `AppService`. We've also created a `sendFile` method that accepts a `file` parameter.

This method makes a GET request to the `/download` endpoint with the `file` query parameter. We've also added a try/catch block to catch any errors that occur.

Finally, we need to call the `sendFile` method from our controller:

```javascript
// src/app.controller.ts

import { Controller, Get, Res, HttpCode, HttpStatus } from '@nestjs/common';

@Controller()
export class AppController {

  constructor(private readonly appService: AppService) {}

  @Get('/download')
  @HttpCode(HttpStatus.OK)
  downloadFile(@Res() res) {
    const file = `${__dirname}/../../test.txt`;
    return this.appService.sendFile(file);
  }
}
```

In the code above, we've injected the `AppService` into our controller. We've also created a `downloadFile` method that calls the `sendFile` method from our service.

If we run the application and visit the `/download` endpoint, we should see the contents of the `test.txt` file.

## Conclusion

In this post, we've seen how to implement file uploads and downloads in a Nest.js application.

We've looked at two different ways to upload files: using the `multer` module or the `Nest.js uploadFile` method. We've also looked at two different ways to download files: using the `Nest.js downloadFile` method or the `Nest.js sendFile` method.

Which method you choose will depend on your specific needs.